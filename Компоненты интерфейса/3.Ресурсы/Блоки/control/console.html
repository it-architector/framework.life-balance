<script>

    /*фильтр по емейлу*/

    if(framework_life_balance_answer_content['filtr_email']){

        out_fitr_email = framework_life_balance_answer_content['filtr_email'];

        $('input[name=email_guest]').val(out_fitr_email);
        $('#filtr-email-del').html('<a class="to_core" href="/control/errors">показать без фильтра</a>');
    }
    else{
        out_fitr_email = '';
    }

    /*данные ошибок*/

    if(framework_life_balance_answer_content['errors']==false){
        out_errors = 'Здесь нет ошибок!';
    }
    else{
        out_errors = '';
        $.each(framework_life_balance_answer_content['errors'], function(error_id, error) {

            if(error['user_email'] != '' && error['user_email'] != 'NULL' && error['user_email'] != null){
                var from = error['user_name'] + ' (' + error['user_email'] + ')';
            }
            else if(error['user_id'] != null && error['user_id'] != 0){
                var from = 'пользователь №' + error['user_id'];
            }
            else{
                var from = '';
            }

            out_errors = out_errors + '<p>' + error['date'] + ' | <span>' + from + '</span> по ссылке <b>/' + error['request'] + '</b> : ' + error['information'] + '</p>';

        });

    }

    $('#errors').html(out_errors);

    /*навигация по ошибкам*/

    if(framework_life_balance_answer_content['errors_pages_count']>0){

        var url = '/control/errors?email=' + out_fitr_email + '&page=';
        var this_page = framework_life_balance_answer_content['errors_page'];
        var count_pages = framework_life_balance_answer_content['errors_pages_count'];

        out_errors_navation = '<p><div class="navigation">Страницы: ';

        // Проверяем нужны ли стрелки назад
        if(this_page!=1){
            out_errors_navation = out_errors_navation + '  <a class="to_core" href="' + url + '1"><<</a>  ';
            out_errors_navation = out_errors_navation + '  <a class="to_core" href="' + url + (this_page-1) + '"><</a>  ';
        }

        // Находим две ближайшие станицы с обоих краев, если они есть
        if((this_page - 2) > 0){
            out_errors_navation = out_errors_navation + '  <a class="to_core" href="' + url + (this_page-2) + '">' + (this_page-2) + '</a>  ';
        }
        if((this_page - 1) > 0){
            out_errors_navation = out_errors_navation + '  <a class="to_core" href="' + url + (this_page-1) + '">' + (this_page-1) + '</a>  ';
        }

        out_errors_navation = out_errors_navation + '<span>' + this_page + '</span>';

        if((this_page + 1) <= count_pages){
            out_errors_navation = out_errors_navation + '  <a class="to_core" href="' + url + (this_page+1) + '">' + (this_page+1) + '</a>  ';
        }

        if((this_page + 2) <= count_pages){
            out_errors_navation = out_errors_navation + '  <a class="to_core" href="' + url + (this_page+2) + '">' + (this_page+2) + '</a>  ';
        }
        // Проверяем нужны ли стрелки вперед
        if (this_page != count_pages){
            out_errors_navation = out_errors_navation + '  <a class="to_core" href="' + url + (this_page+1) + '">></a>  ';
            out_errors_navation = out_errors_navation + '  <a class="to_core" href="' + url + count_pages + '">>></a>  ';
        }

        out_errors_navation = out_errors_navation + '</div></p>';

        $('#errors-navation-up').html(out_errors_navation);
        $('#errors-navation-bottom').html(out_errors_navation + '<p><u><a class="to_core" href="/control/errors?delete_errors=true">Удалить все записи</a></u></p>');

    }

    /*ошибки из файла лога*/
    if(framework_life_balance_answer_content['errors_in_file_log']==null){
        out_errors_in_file_log = 'Файл ошибок пуст!';
    }
    else{
        out_errors_in_file_log = '';
        $.each(framework_life_balance_answer_content['errors_in_file_log'], function(error_id, error) {

            out_errors_in_file_log = out_errors_in_file_log + '<p>' + error + '</p>';

        });

        out_errors_in_file_log = out_errors_in_file_log + '<p><u><a class="to_core" href="/control/errors?delete_file_log=true">Очистить файл лога</a></u></p>';
    }

    $('#out_errors_in_file_log').html(out_errors_in_file_log);
</script>
<!-- NEWS -->
<section id="news">

    <!-- CONTAINER -->
    <div class="container">
        <h2><b>Ошибки сохранённые в базе</b></h2>


        <!-- RECENT POSTS -->
        <p class="row recent_posts" data-appear-top-offset="-200" data-animated="fadeInUp">

            <form action="/control/errors" method="post">
            <input class="required mini_width" type="text" name="email_guest" value="Фильтр по email" onFocus="if (this.value == 'Фильтр по email') this.value = '';" onBlur="if (this.value == '') this.value = 'Фильтр по email';" />
        <input class="contact_btn" type="submit" value="Найти" /> <b id="filtr-email-del"></b>
            </form>

        <div id="errors-navation-up"></div>
        <div id="errors"></div>
        <div id="errors-navation-bottom"></div>
        <hr>
        <h2><b>Ошибки сохранённые в файле лога</b></h2>
        <div id="out_errors_in_file_log"></div>

        </div><!-- RECENT POSTS -->
    </div><!-- //CONTAINER -->
</section><!-- //NEWS -->


